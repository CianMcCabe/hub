#!/usr/bin/env node

var flatiron = require('flatiron')
  , path = require('path')
  , app = flatiron.app;

var usage = [
  '',
  '\033[36m  ___ ___   ____ ___ __________\033[39m',
  '\033[36m /   |   \\ |    |   \\\\______   \\\033[39m',
  '\033[36m/    ~    \\|    |   / |    |  _/\033[39m',
  '\033[36m\\    Y    /|    |  /  |    |   \\\033[39m',
  '\033[36m \\___|_  / |______/   |______  /\033[39m',
  '\033[36m       \\/                    \\/\033[39m',
  '',
  'Command line tool to interact with github',
  'https://github.com/pksunkara/hub',
];

var gitCmds = [
  'clone',
  'remote'
];

app.config.file({ file: '.hubconfig', dir: process.env.HOME, search: true });

app.use(require('flatiron-cli-version'), { route: true });

app.use(flatiron.plugins.cli, {
  source: path.join(__dirname, '..', 'lib', 'commands'),
  argv: require('../lib/argv'),
  prompt: require('../lib/prompt'),
  usage: usage.join('\n')
});

app.use(require('flatiron-cli-config'), { store: 'file' });
app.use(require('../lib/git'));

if (app.config.get('welcome') || gitCmds.indexOf(app.argv._[0]) == -1 || app.argv._.length < 2) {
  app.use(require('flatiron-cli-ok'), { show: true });
  app.start();
} else {
  app.start(function (err) {
    if (err && err.message) {
      app.log.error(err.message.red.bold);
    }
  });
}
